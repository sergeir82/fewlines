(function(){(function(e){var t;t=function(){function t(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v=this;this.defaults={closeMark:"close",openMark:"...",newLine:false,lines:2};this.opts=e.extend({},this.defaults,n);this.$el=e(t);f="";i=e("<div>x</div>").css({position:"absolute",left:0,top:"-3000px",visibility:"hidden"}).width(e(this.$el).width()).css(e(this.$el).css(["font-size","font-weight","font-family"])).appendTo("body");l=e(t).text();u=i.height();h=l.split(/\b/);a=false;this.openMark=e("<a href='#'>"+this.opts.openMark+"</a>");if(this.opts.newLine){this.openMark.css({display:"block"})}this.openMark.bind("click",function(e){e.preventDefault();return v.show()});this.closeMark=e("<a href='#'>"+this.opts.closeMark+"</a>").hide();this.closeMark.bind("click",function(e){e.preventDefault();return v.close()});for(o=p=0,d=h.length-1;0<=d?p<=d:p>=d;o=0<=d?++p:--p){r=this.getLines(h,o);if(!this.opts.newLine){r+=this.opts.openMark}i.text(r);if(i.height()>this.opts.lines*u){a=true;break}}c=this.getLines(h,o-1);s=l.slice(c.length);this.hidePart=e("<span>").hide().text(s);if(a){this.$el.text(c).append(this.openMark).append(this.hidePart).append(this.closeMark)}i.remove();this.$el}t.prototype.getLines=function(e,t){return e.slice(0,+t+1||9e9).join("").replace(/\W+$/,"")};t.prototype.show=function(){this.openMark.hide();this.hidePart.show();return this.closeMark.css("display","block")};t.prototype.close=function(){this.openMark.show();this.hidePart.hide();return this.closeMark.hide()};t.prototype.init=function(){var e;return e=this};return t}();return e.fn.fewlines=function(n){if(this.length){return this.each(function(){var r;r=new t(this,n);r.init();return e(this).data("fewlines",r)})}}})(jQuery)}).call(this)